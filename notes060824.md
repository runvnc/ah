for each service or command associated with a model,
  for each flag or equivalent flag group or no-tags,
     from list of models matching that flag/group and service/command,
        select preferred model

